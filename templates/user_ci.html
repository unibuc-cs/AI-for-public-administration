<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ app_title }} – CI Form</title>
    <style>
      :root { --rail: 1fr; --main: 4fr; }
      html, body { height: 100%; }
      body{ font-family:system-ui,Arial; margin:0; padding:16px; background:#f8f9fb; color:#222; }
      .two-col { display:grid; grid-template-columns: var(--main) var(--rail); gap:16px; align-items:start; }
      @media (max-width: 990px){ .two-col{ grid-template-columns: 1fr; } }
      main .card, fieldset{ background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:14px; }
      fieldset{ margin-bottom:16px; }
      label{ display:block; margin-top:8px }
      input,select,button{ padding:8px; border-radius:8px; border:1px solid #ccc; width:100% }
      .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
      .ok{ color:#0a7f2e } .err{ color:#b00 } .muted{ color:#666; font-size:12px } .hidden{ display:none }
      img.thumb{ height:48px; border:1px solid #ddd; border-radius:6px; margin-right:8px }
      aside.chat-col { position: sticky; top: 16px; height: calc(100vh - 32px); overflow:auto; }
      .dim { opacity:.45; pointer-events:none; filter: grayscale(40%); }
    </style>
</head>
<body data-default-sid="{{ sid }}">
    {% include "_toast.html" %}

      <div class="two-col">
          <main>
              <h1>{{ app_title }} – Create CI</h1>
              <p class="muted">Session: <span id="sidSpan"></span></p>

              <!-- Appointment -->
                <fieldset id="slotsBox">
                  <legend>Choose appointment (required before filling the form)</legend>
                  <div class="row">
                    <div>
                      <label>Location
                        <select id="loc">
                          <option value="Bucuresti-S1">Bucuresti-S1</option>
                          <option value="Ilfov-01">Ilfov-01</option>
                        </select>
                      </label>
                    </div>
                    <div>
                      <label>Slots
                        <select id="slot"></select>
                      </label>
                    </div>
                  </div>
                  <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
                    <button id="btnUseSlot" type="button">Use this slot</button>
                    <span class="muted">Slotul este rezervat temporar.</span>
                  </div>
                  <div id="slotPicked" class="muted" style="margin-top:8px"></div>
                </fieldset>

              <div id="gateEligType" class="dim">
                <fieldset>
                  <div>
                    <label>Type
                      <select id="type">
                          <option value="None">Selecteaza</option>
                        <option value="CEI">Carte electronica de identitate</option>
                        <option value="CIS">Carte de identitate simpla</option>
                          <option value="VR">Viza resedinta</option>
                      </select>
                    </label>
                    <label>Eligibility
                      <select id="elig">
                          <option value="None">Selecteaza</option>
                        <option value="EXP_60">Expira ≤60 zile</option>
                        <option value="AGE_14">Varsta 14 ani</option>
                        <option value="CHANGE_NAME">Schimbare nume</option>
                          <option value="CHANGE_ADDR">Schimbare adresa/resedinta</option>
                        <option value="LOSS">pierdut/furat/deteriorat)</option>
                      </select>
                    </label>
                  </div>
                  <div>
                    <label>Documents provided (toggle to ✓):</label>
                    <label id="row_doc_cert"><input id="doc_cert" type="checkbox" disabled> Certificat de nastere</label>
                    <label id="row_doc_ci"><input id="doc_ci"   type="checkbox" disabled> CI veche</label>
                    <label id="row_doc_addr"><input id="doc_addr" type="checkbox" disabled> Dovada adresa</label>
                  </div>
                </fieldset>

                  <!-- Gate: form disabled until above is filled -->
                  <div id="gateApp" class="dim">
                  <!-- Person info -->
                  <fieldset>
                    <legend>Person</legend>
                    <div class="row">
                      <div>
                        <label>CNP <input id="cnp" placeholder="1860903226868"></label>
                        <label>Nume <input id="nume" placeholder="Alin"></label>
                        <label>Prenume <input id="prenume" placeholder="Stefanescu"></label>
                        <label>Email <input id="email" placeholder="alin@fmi.unibuc.ro" type="email"></label>
                        <label>Telefon <input id="telefon" placeholder="0754770829"></label>
                      </div>
                      <div>
                        <label>Adresa <input id="adresa" placeholder="Bucuresti, sector 1, Str. Academiei nr 14, Fac. Matematica Informatica"></label>
                        <label>Doc. Domiciliu
                          <select id="docTip">
                            <option value="extrasCF">extrasCF</option>
                            <option value="contract">contract</option>
                            <option value="adeverinta">adeverinta</option>
                          </select>
                        </label>
                      </div>
                    </div>
                  </fieldset>

                  <!-- Application -->
                  <fieldset>
                    <legend>Application</legend>
                      <!-- Upload documents -->
                      <fieldset>
                        <legend>Upload documents</legend>
                        <p class="muted">Accepted: PDF / JPG / PNG (max {{ MAX_UPLOAD_MB or 10 }} MB)</p>

                        <div style="display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap">
                          <div style="flex:2">
                            <label>File
                              <input type="file" id="file" />
                            </label>
                          </div>
                          <div style="flex:1">
                            <label>Tip document
                              <select id="kind_hint" required>
                                <option value="" selected disabled>Select tip</option>
                                <option value="cert_nastere">cert_nastere</option>
                                <option value="ci_veche">ci_veche</option>
                                <option value="dovada_adresa">dovada_adresa</option>
                              </select>
                            </label>
                          </div>
                          <div>
                            <button id="btnUpload" type="button">Upload</button>
                          </div>
                        </div>

                        <div id="uploads_list" class="muted" style="margin-top:10px"></div>
                      </fieldset>
                    <div id="valMsg" class="muted hidden"></div>
                    <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
                      <button id="btnValidate" type="button">Validate</button>
                      <button id="btnCreateCase" type="button">Create case & schedule</button>
                    </div>
                    <pre id="result" class="muted" style="margin-top:8px; white-space:pre-wrap;"></pre>

                  </fieldset>
                  </div> <!-- /gateApp -->


              </div> <!-- /gateEligType -->

          </main>

          <aside class="chat-col">
              {% set chat_mode = 'user' %}
              {% set chat_context = 'ci' %}
              {% include "_chat_widget.html" with context %}
          </aside>
      </div>
<script src="/static/js/user_ci.js"></script>
</body>
</html>
